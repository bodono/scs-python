[build-system]
build-backend = 'mesonpy'
requires = [
  "numpy >= 2.0.0; python_version > '3.8'",
  "oldest-supported-numpy; python_version <= '3.8'",
  "meson-python"
]

[project]
name = 'scs'
version = "3.2.7"
description = 'Splitting conic solver'
readme = 'README.md'
requires-python = '>=3.7'
license = {file = 'LICENSE'}
authors = [
  {name = "Brendan O'Donoghue", email = "bodonoghue85@gmail.com"}]
dependencies = [
   'numpy',
   'scipy',
]

[tool.cibuildwheel]
# Load SCS source submodule
before-all = "git submodule update --init"
skip = [
  "pp*", # Disable building PyPy wheels on all platforms
  "*-manylinux_i686", # Can't get BLAS to work there
  # temporary, to speed up testing:
  "cp37*",
  "cp38*",
  "cp39*",
  "cp310*",
  "cp311*",
  "cp312*",
]
# Test
test-requires = "pytest"
test-command = [
  "echo wheel installed successfully",
  "pytest {package}/test",
]


# Works
[[tool.cibuildwheel.overrides]]
select = "*-manylinux_x86_64"
inherit.before-all = "append"
before-all = [
  "yum check-update",
  "yum search blas", # look at what's available
  "yum install -y openblas-devel.x86_64"]

# Compiles, recognizes BLAS, but doesn't link
[[tool.cibuildwheel.overrides]]
select = "*-manylinux_i686"
inherit.before-all = "append"
before-all = [
  "yum check-update",
  "yum search blas", # look at what's available
  "yum install -y blas-devel.i686"]

[[tool.cibuildwheel.overrides]]
select = "*-musllinux_x86_64"
inherit.before-all = "append"
before-all = [
  "apt update"
  "apt-cache search blas", # look at what's available
  "apt install -y libopenblas-dev"]
